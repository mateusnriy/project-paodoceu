datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum PerfilUsuario {
  ADMINISTRADOR
  ATENDENTE
}

enum StatusPedido {
  PENDENTE
  PRONTO
  ENTREGUE
  CANCELADO
}

enum MetodoPagamento {
  DINHEIRO
  CARTAO_CREDITO
  CARTAO_DEBITO
  PIX
}

model Usuario {
  id            String        @id @default(uuid())
  nome          String
  email         String        @unique
  senha         String
  perfil        PerfilUsuario @default(ATENDENTE)
  ativo         Boolean       @default(true) // Added based on frontend usage
  criado_em     DateTime      @default(now())
  atualizado_em DateTime      @updatedAt
  pedidos       Pedido[]

  @@map("usuarios")
}

model Categoria {
  id            String    @id @default(uuid())
  nome          String    @unique
  criado_em     DateTime  @default(now()) // Corrected placement
  atualizado_em DateTime  @updatedAt
  produtos      Produto[]

  @@map("categorias")
}

model Produto {
  id            String       @id @default(uuid())
  nome          String
  descricao     String?
  preco         Float // Corrected placement
  estoque       Int          @default(0)
  imagem_url    String?      // Added based on frontend usage
  categoria_id  String
  criado_em     DateTime     @default(now())
  atualizado_em DateTime     @updatedAt
  categoria     Categoria    @relation(fields: [categoria_id], references: [id])
  itens_pedido  ItemPedido[]

  @@map("produtos")
}

model Pedido {
  id                    String       @id @default(uuid()) // Corrected placement
  numero_sequencial_dia Int
  valor_total           Float
  cliente_nome          String?
  status                StatusPedido @default(PENDENTE) // Corrected placement
  criado_em             DateTime     @default(now())
  atualizado_em         DateTime     @updatedAt
  atendente_id          String?
  atendente             Usuario?     @relation(fields: [atendente_id], references: [id]) // Corrected placement
  itens                 ItemPedido[]
  pagamento             Pagamento?

  @@map("pedidos") // Corrected placement
}

model ItemPedido {
  id             String  @id @default(uuid())
  pedido_id      String
  produto_id     String
  quantidade     Int
  preco_unitario Float
  subtotal       Float
  pedido         Pedido  @relation(fields: [pedido_id], references: [id])
  produto        Produto @relation(fields: [produto_id], references: [id])

  @@map("itens_pedido")
}

model Pagamento {
  id         String          @id @default(uuid()) // Corrected placement
  pedido_id  String          @unique
  metodo     MetodoPagamento
  valor_pago Float
  troco      Float           @default(0)
  criado_em  DateTime        @default(now())
  pedido     Pedido          @relation(fields: [pedido_id], references: [id])

  @@map("pagamentos")
}
